@model Overhaul.Application.Models.RegisterOverhaulModel;
@{ 
    Layout = "_LayoutRegister";
}





<link href="~/lib/select2/select2.min.css" rel="stylesheet" />
<link href="~/assets/vendor_plugins/dropzone-5.7.0/dist/dropzone.css" rel="stylesheet" />
<link href="~/assets/vendor_components/sweetalert2/sweetalert2.min.css" rel="stylesheet" />
<style>
    .date-mask {
        text-align: left !important;
        direction: ltr;
    }
</style>

<div class="row">
    <div class="col-12">
        <div class="box">
            <div class="box-header">
                <h4 class="box-title">ثبت نام اورهال</h4>
            </div>
            <div class="box-body">
                <form class="form" action="OverhaulRegister/Save" method="post" >
                    <div class="box-body">
                        <div class="row">
                            <div class="col-lg-3 col-md-6 col-sm-12">
                                <div class="form-group">
                                    <label class="form-label">نام</label>
                                    <input asp-for="FirstName" type="text" class="form-control">
                                    <span asp-validation-for="FirstName" />
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-6 col-sm-12">
                                <div class="form-group">
                                    <label class="form-label">نام خانوادگی</label>
                                    <input asp-for="LastName" type="text" class="form-control">
                                    <span asp-validation-for="LastName" />
                                </div>
                            </div>

                            <div class="col-lg-3 col-md-6 col-sm-12">
                                <div class="form-group">
                                    <label class="form-label">نام پدر</label>
                                    <input asp-for="FatherName" type="text" class="form-control">
                                    <span asp-validation-for="FatherName" />
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-6 col-sm-12">
                                <div class="form-group">
                                    <label class="form-label">کد ملی</label>
                                    <input asp-for="Nationality" type="text" class="form-control date-mask">
                                    <span asp-validation-for="Nationality" />
                                </div>
                            </div>

                            <div class="col-lg-3 col-md-6 col-sm-12">
                                <div class="form-group">
                                    <label class="form-label">شماره شناسنامه</label>
                                    <input asp-for="shSh" type="text" class="form-control">
                                    <span asp-validation-for="shSh" />
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-6 col-sm-12">
                                <div class="form-group">
                                    <label class="form-label">تاریخ تولد</label>
                                    <input asp-for="BirthDay" type="text" class="form-control date-mask">
                                    <span asp-validation-for="BirthDay" />
                                    <div id="ageWarning" class="text-danger mt-2" style="display: none;"></div> <!-- محل نمایش پیام -->
                                </div>
                            </div>

                            <div class="col-lg-3 col-md-6 col-sm-12">
                                <div class="form-group">
                                    <label class="form-label">شماره کارت بانک تجارت</label>
                                    <input asp-for="BankCardNo" type="text" class="form-control date-mask">
                                    <span asp-validation-for="BankCardNo" />
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-6 col-sm-12">
                                <div class="form-group">
                                    <label class="form-label">شماره حساب بانک تجارت</label>
                                    <input asp-for="IBAN" type="text" class="form-control">
                                    <span asp-validation-for="IBAN" />
                                </div>
                            </div>

                            <div class="col-lg-3 col-md-6 col-sm-12">
                                <div class="form-group">
                                    <label class="form-label">شماره بیمه</label>
                                    <input asp-for="SSN" type="text" class="form-control">
                                    <span asp-validation-for="SSN" />
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-6 col-sm-12">
                                <div class="form-group">
                                    <label class="form-label">شماره موبایل</label>
                                    <input asp-for="Mobile" type="text" class="form-control date-mask">
                                    <span asp-validation-for="Mobile" />
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-6 col-sm-12">
                                <div class="form-group">
                                    <label class="form-label">شماره تلفن ثابت (با کد شهر)</label>
                                    <input asp-for="Tell" type="text" class="form-control">
                                    <span asp-validation-for="Tell" />
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-6 col-sm-12">
                                <div class="form-group">
                                    <label class="form-label">کد پستی</label>
                                    <input asp-for="PostalCode" type="text" class="form-control date-mask">
                                    <span asp-validation-for="PostalCode" />
                                </div>
                            </div>

                            <div class="col-lg-3 col-md-12 col-sm-12">
                                <div class="form-group">
                                    <label class="form-label">آدرس</label>
                                    <input asp-for="Address" type="text" class="form-control">
                                    <span asp-validation-for="Address" />

                                </div>
                            </div>


                            <div class="col-lg-3 col-md-6 col-sm-12">
                                <div class="form-group">
                                    <label class="form-label">وضعیت نظام وظیفه</label>
                                    <select asp-for="MilitaryCardTypeId" asp-items="@Model.SelectListMilitaryCardType" class="form-control">
                                        <option value="">یک گزینه انتخاب کنید</option>
                                    </select>
                                    <span asp-validation-for="MilitaryCardTypeId" />
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-6 col-sm-12">
                                <div class="form-group">
                                    <label class="form-label">وضعیت تاهل</label>
                                    <select asp-for="MaritalStatusTypeId" asp-items="@Model.SelectListMaritalStatusType" class="form-control">
                                        <option value="">یک گزینه انتخاب کنید</option>
                                    </select>
                                    <span asp-validation-for="MaritalStatusTypeId" />
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-6 col-sm-12">
                                <div class="form-group">
                                    <label class="form-label">وضعیت ایثارگری</label>
                                    <select asp-for="IsargariTypeId" asp-items="@Model.SelectListIsargariType" class="form-control">
                                        <option value="">یک گزینه انتخاب کنید</option>
                                    </select>
                                    <span asp-validation-for="IsargariTypeId" />
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-6 col-sm-12">
                                <div class="form-group">
                                    <label class="form-label">آخرین مدرک تحصلی</label>
                                    <input asp-for="Degree" type="text" class="form-control">
                                    <span asp-validation-for="Degree" />
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-6 col-sm-12">
                                <div class="form-group">
                                    <label class="form-label">رشته تحصیلی</label>
                                    <input asp-for="Major" type="text" class="form-control">
                                    <span asp-validation-for="Major" />
                                </div>
                            </div>
                            <div class="col-lg-12 col-md-6 col-sm-12" style="margin-top:30px;">
                                <div class="form-group">
                                    <label class="form-label">آیا در اورهال سالهای گذشته شرکت کرده اید؟</label>
                                    <input checked asp-for="State" type="checkbox" >
                                    <span asp-validation-for="State" />
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr />
                    <div class="jumbotron" id="uploadSection" style="display: none;">
                        <div class="dropzone" id="dropzoneForm" style="background: none; border: none;">
                            <div class="fallback">
                                <input name="file" type="file" multiple accept="image/*" />
                                <input type="submit" value="Upload" />
                            </div>
                        </div>
                    </div>
                    <!-- /.box-body -->
                    <div class="box-footer text-end">
                        <button type="button" class="btn btn-warning me-1">
                            <i class="ti-trash"></i> لغو
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="ti-save-alt"></i> ذخیره
                        </button>
                    </div>
                </form>


            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
    <script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>
    <script src="~/lib/select2/select2.min.js"></script>

    <script src="~/assets/vendor_plugins/dropzone-5.7.0/dist/dropzone.js"></script>

    <script src="~/assets/vendor_plugins/input-mask/jquery.inputmask.extensions.js"></script>
    <script src="~/assets/vendor_plugins/input-mask/jquery.inputmask.js"></script>
    <script src="~/assets/vendor_components/sweetalert2/sweetalert2.min.js"></script>
    <script>
        $(document).ready(function () {
            Swal.fire({
                title: "تایید شرایط",
                html:
                `
                <ul style="text-align: justify;">
                <li style="margin-bottom: 10px;">در صورت تکمیل فرم‌ زیر، جذب یا استخدام رسمی، قراردادی، پیمانکاری و یا روزمزدی در شرکت پتروشیمی تبریز و زیرمجموعه‌های آن ایجاد نمی‌شود</li>
                <li style="margin-bottom: 10px;">بارگذاری تصویر کارت ملی،صفحه اول شناسنامه ، صفحه توضیحات شناسنامه، آخرین مدرک تحصیلی و عکس پرسنلی شخص متقاضی (با فرمت JPG و حداکثر حجم یک مگابایت) برای ثبت نام الزامی است.</li>
                <li style="margin-bottom: 10px;">دریافت کد ثبت نام به منزله اتمام کامل فرایند ثبت نام تلقی می‌شود.</li>
                </ul>
      <div style="text-align: right; direction: rtl; margin-top: 20px;">
          <input type="checkbox" id="acceptTerms" style="margin-left: 10px;">
          <label for="acceptTerms">شرایط را می‌پذیرم</label>
      </div>
    `,
                icon: "info",
                confirmButtonText: "ادامه",
                confirmButtonColor: "#3085d6",
                customClass: {
                    popup: "rtl-text"
                },
                showCancelButton: false,
                allowOutsideClick: false,
                didOpen: () => {
                    const confirmBtn = Swal.getConfirmButton();
                    confirmBtn.disabled = true;
                    document.getElementById('acceptTerms').addEventListener('change', function () {
                        confirmBtn.disabled = !this.checked;
                    });
                }
            });


            $("#BirthDay").inputmask('shamsi', { placeholder: '----/--/--' });
            $("#BankCardNo").inputmask("9999-9999-9999-9999", {
                placeholder: "____-____-____-____", // نمایش راهنما
                clearMaskOnLostFocus: true, // حذف کاراکترهای اضافی هنگام خروج از فیلد
                showMaskOnHover: false // نمایش ماسک فقط هنگام تایپ
            });
            $("#PostalCode").inputmask("9999999999", {
                placeholder: "----------", // نمایش راهنما
                clearMaskOnLostFocus: true, // حذف کاراکترهای اضافی هنگام خروج از فیلد
                showMaskOnHover: false // نمایش ماسک فقط هنگام تایپ
            });
            $("#Mobile").inputmask("09999999999", {
                placeholder: "-----------", // نمایش راهنما
                clearMaskOnLostFocus: true, // حذف کاراکترهای اضافی هنگام خروج از فیلد
                showMaskOnHover: false // نمایش ماسک فقط هنگام تایپ
            });
            $("#Nationality").inputmask("9999999999", {
                placeholder: "----------", // نمایش راهنما
                clearMaskOnLostFocus: true, // حذف کاراکترهای اضافی هنگام خروج از فیلد
            });
            $('#State').prop('checked', false); 
            $("#Nationality").on("input", function () {
                var nationalId = $(this).val();
                var isValid = /^[0-9]{10}$/.test(nationalId); // بررسی اینکه فقط 10 رقم عددی باشد

                if (isValid) {
                    $("#uploadSection").fadeIn(); // نمایش بخش آپلود
                } else {
                    $("#uploadSection").fadeOut(); // مخفی کردن در صورت نامعتبر بودن
                }
            });
            CalcOld();

        });
        function CalcOld() {
            $("#BirthDay").on("focusout", function () {
                var birthDate = $(this).val().trim();

                // بررسی فرمت صحیح (سال/ماه/روز)
                var datePattern = /^\d{4}\/\d{2}\/\d{2}$/;
                if (!datePattern.test(birthDate)) {
                    $("#ageWarning").hide();
                    return;
                }

                var birthYear = parseInt(birthDate.split('/')[0]); // گرفتن سال از ورودی
                var currentYear = 1404; // دریافت سال جاری
                var age = currentYear - birthYear; // محاسبه سن

                if (age <= 18 || age > 65) {

                    Swal.fire(
                        {
                            text: 'محدوده سنی قابل قبول ما بین 18 الی 65 سال می باشد',
                            title: "خطا",
                            icon: 'error',
                            confirmButtonColor: '#5156be'
                        }
                    )
                } else {
                    
                }
            });
        }

        function SaveComplete(data) {

            if (data.responseJSON.isSuccess !== true) {
                Swal.fire(
                    {
                        text: data.responseJSON.message,
                        title: "خطا",
                        icon: 'error',
                        confirmButtonColor: '#5156be'
                    }
                )
            }
            if (data.responseJSON.isSuccess === true) {
                Swal.fire(
                    {
                        text: data.responseJSON.message,
                        title: "توجه",
                        icon: 'success',
                        confirmButtonColor: '#5156be'
                    }
                )
            }
        }
        var fu = Dropzone.options.dropzoneForm = {
            url: '/OverhaulRegister/SaveUploadedFile',
            addRemoveLinks: true,
            uploadMultiple: true,
            dictDefaultMessage: 'برای بارگذاری مدارک اینجا کلیک کنید',
            dictRemoveFile: 'حذف فایل',
            dictMaxFilesExceeded: 'حداکثر تعداد فایل قابل بارگذاری 5 عدد میباشد',
            acceptedFiles: '.jpg,.jpeg,.png,.gif,.bmp,.webp,.tiff,.svg',
            maxFiles: 7,
            maxFilesize: 1,
            init: function () {
                this.on("complete", function (data) {
                    var res = JSON.parse(data.xhr.responseText);

                });
                this.on("sending", function (file, xhr, formData) {
                    formData.append($('#Nationality').val(), "Nationality");
                    console.log(formData)
                });
            },
            removedfile: function (file) {
                console.log(file.name);
                $.post('RemoveUploadedFile', { filename: file.name, Nationality: $('#Nationality').val() }, function (data) {
                    console.log(data);
                    $('#To').val(data);
                });
                file.previewElement.remove();
            }
        };
    </script>
}